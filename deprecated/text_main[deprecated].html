<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This module contains the main Python class for data control: TextDataMain">

<title>that-nlp-library - Text Main</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="that-nlp-library - Text Main">
<meta property="og:description" content="This module contains the main Python class for data control: TextDataMain">
<meta property="og:site_name" content="that-nlp-library">
<meta name="twitter:title" content="that-nlp-library - Text Main">
<meta name="twitter:description" content="This module contains the main Python class for data control: TextDataMain">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">that-nlp-library</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Text Main</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to that-nlp-library</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">1. Quick Starts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Main</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../model_classification_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Controller Tutorial: Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../model_lm_roberta_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Controller Tutorial: Training a Roberta Language Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">2. All Use Cases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">a. Roberta-based models for Supervised Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_singlehead.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model (Custom Single Head)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_multihead.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model (Multi Head)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_multihead_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model (Regression)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_conditional_prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model with Conditional Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_dhc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model with Deep Hierarchical Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_multilabel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model (Multi-Label)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">b. GPT2-based models for Supervised Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gpt2_singlehead.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GPT2 model (Custom Single Head)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gpt2_multihead.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GPT2 model (Multi Head)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gpt2_multihead_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GPT2 model (Regression)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">c.&nbsp;Masked Language Model Training</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../model_lm_roberta_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Controller Tutorial: Training a Roberta Language Model</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">d.&nbsp;Causal Language Model Training</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../model_lm_gpt2_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Controller Tutorial: Training a GPT2 Language Model</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">e. Training A Streamed Dataset</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_singlehead_for_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta model with a streamed dataset (Custom Single Head)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../roberta_lm_for_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta Language Model for a streamed dataset</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">3. Evaluations For Supervised Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../evaluations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Evaluations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">4. Hidden States Extraction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../hidden_states.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Feature Extraction From Hidden States</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">5. Text Classes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false">
 <span class="menu-text">a. Text Processing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_augmentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Augmentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_transformation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Transformation</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false">
 <span class="menu-text">b. Text Controller For Supervised Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Main</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_main_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Main Streaming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_main_benchmark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Processing Benchmark</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="false">
 <span class="menu-text">c.&nbsp;Text Controller For Language Modeling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_main_lm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Main For Language Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../text_main_lm_streaming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Main For Language Model - Streaming</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="true">
 <span class="menu-text">6. Model Classes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" aria-expanded="false">
 <span class="menu-text">a. Model Controller For Supervised Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../model_main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Main Functions and Controller</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" aria-expanded="false">
 <span class="menu-text">b. Model Controller for Language Modeling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../model_lm_main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Language Model Main Functions and Controller</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" aria-expanded="false">
 <span class="menu-text">c.&nbsp;Roberta-based classification Model</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models.roberta.classifiers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Roberta Classifiers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models.roberta.deep_hierarchical_classifiers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deep Hierarchical Classifiers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models.roberta.conditional_prob_classifiers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability Classifiers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" aria-expanded="false">
 <span class="menu-text">d.&nbsp;GPT2-based classification Model</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models.gpt2.classifiers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GPT2 Classifiers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" aria-expanded="true">
 <span class="menu-text">7. Utility</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">utils</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#text-transformation-and-tokenizer-explanation" id="toc-text-transformation-and-tokenizer-explanation" class="nav-link active" data-scroll-target="#text-transformation-and-tokenizer-explanation">Text transformation and Tokenizer Explanation</a>
  <ul class="collapse">
  <li><a href="#tokenizer_explain" id="toc-tokenizer_explain" class="nav-link" data-scroll-target="#tokenizer_explain">tokenizer_explain</a></li>
  <li><a href="#two_steps_tokenization_explain" id="toc-two_steps_tokenization_explain" class="nav-link" data-scroll-target="#two_steps_tokenization_explain">two_steps_tokenization_explain</a></li>
  </ul></li>
  <li><a href="#datasetdict" id="toc-datasetdict" class="nav-link" data-scroll-target="#datasetdict">DatasetDict</a>
  <ul class="collapse">
  <li><a href="#datasetdictize_given_idxs" id="toc-datasetdictize_given_idxs" class="nav-link" data-scroll-target="#datasetdictize_given_idxs">datasetdictize_given_idxs</a></li>
  </ul></li>
  <li><a href="#class-textdatamain" id="toc-class-textdatamain" class="nav-link" data-scroll-target="#class-textdatamain">Class TextDataMain</a>
  <ul class="collapse">
  <li><a href="#textdatamain" id="toc-textdatamain" class="nav-link" data-scroll-target="#textdatamain">TextDataMain</a></li>
  <li><a href="#constructor-class-method-calls" id="toc-constructor-class-method-calls" class="nav-link" data-scroll-target="#constructor-class-method-calls">Constructor/ Class Method calls</a></li>
  <li><a href="#textdatamain.to_df" id="toc-textdatamain.to_df" class="nav-link" data-scroll-target="#textdatamain.to_df">TextDataMain.to_df</a></li>
  <li><a href="#textdatamain.to_datasetdict" id="toc-textdatamain.to_datasetdict" class="nav-link" data-scroll-target="#textdatamain.to_datasetdict">TextDataMain.to_datasetdict</a></li>
  <li><a href="#textdatamain.save_as_pickles" id="toc-textdatamain.save_as_pickles" class="nav-link" data-scroll-target="#textdatamain.save_as_pickles">TextDataMain.save_as_pickles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/anhquan0412/that-nlp-library/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Text Main</h1>
</div>

<div>
  <div class="description">
    This module contains the main Python class for data control: <code>TextDataMain</code>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> __future__ <span class="im">import</span> annotations</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedShuffleSplit</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder,MultiLabelBinarizer</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> DatasetDict,Dataset</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> that_nlp_library.utils <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> that_nlp_library.text_transformation <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> that_nlp_library.text_augmentation <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> importlib.machinery <span class="im">import</span> SourceFileLoader</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="text-transformation-and-tokenizer-explanation" class="level2">
<h2 class="anchored" data-anchor-id="text-transformation-and-tokenizer-explanation">Text transformation and Tokenizer Explanation</h2>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tokenizer_explain(inp, <span class="co"># Input sentence</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                      tokenizer, <span class="co"># Tokenizer (preferably from HuggingFace)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                      split_word<span class="op">=</span><span class="va">False</span> <span class="co"># Is input `inp` split into list or not</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                     ):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Display results from tokenizer"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'----- Tokenizer Explained -----'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'--- Input ---'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(inp)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'--- Tokenized results --- '</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tokenizer(inp,is_split_into_words<span class="op">=</span>split_word))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    tok <span class="op">=</span> tokenizer.encode(inp,is_split_into_words<span class="op">=</span>split_word)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'--- Results from tokenizer.convert_ids_to_tokens ---'</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tokenizer.convert_ids_to_tokens(tok))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'--- Results from tokenizer.decode --- '</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(tokenizer.decode(tok))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L20" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="tokenizer_explain" class="level3">
<h3 class="anchored" data-anchor-id="tokenizer_explain">tokenizer_explain</h3>
<blockquote class="blockquote">
<pre><code> tokenizer_explain (inp, tokenizer, split_word=False)</code></pre>
</blockquote>
<p>Display results from tokenizer</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inp</td>
<td></td>
<td></td>
<td>Input sentence</td>
</tr>
<tr class="even">
<td>tokenizer</td>
<td></td>
<td></td>
<td>Tokenizer (preferably from HuggingFace)</td>
</tr>
<tr class="odd">
<td>split_word</td>
<td>bool</td>
<td>False</td>
<td>Is input <code>inp</code> split into list or not</td>
</tr>
</tbody>
</table>
<p>Let’s load a tokenizer from EnviBert model. Uncomment the command line below to download necessary files to build this tokenizer</p>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install gdown</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !gdown 14X9fGijA7kdNfe4dM_8gqfxIWtj1Q-hb -O ./envibert_cache --folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>cache_dir<span class="op">=</span>Path(<span class="st">'./envibert_tokenizer'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> SourceFileLoader(<span class="st">"envibert.tokenizer"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                             <span class="bu">str</span>(cache_dir<span class="op">/</span><span class="st">'envibert_tokenizer.py'</span>)).load_module().RobertaTokenizer(cache_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that Envibert tokenizer does not required the input to be tokenized using word_tokenize from UnderTheSea library</p>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> <span class="st">'hội cư dân chung cư sen hồng - chung cư lotus sóng thần thủ đức'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tokenizer_explain(inp,tokenizer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Tokenizer Explained -----
--- Input ---
hội cư dân chung cư sen hồng - chung cư lotus sóng thần thủ đức

--- Tokenized results --- 
{'input_ids': [0, 227, 1033, 191, 664, 1033, 7366, 2615, 13, 664, 1033, 671, 1355, 2294, 993, 413, 2900, 2], 'token_type_ids': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

--- Results from tokenizer.convert_ids_to_tokens ---
['&lt;s&gt;', '▁hội', '▁cư', '▁dân', '▁chung', '▁cư', '▁sen', '▁hồng', '▁-', '▁chung', '▁cư', '▁lot', 'us', '▁sóng', '▁thần', '▁thủ', '▁đức', '&lt;/s&gt;']

--- Results from tokenizer.decode --- 
&lt;s&gt; ▁hội ▁cư ▁dân ▁chung ▁cư ▁sen ▁hồng ▁- ▁chung ▁cư ▁lot us ▁sóng ▁thần ▁thủ ▁đức &lt;/s&gt;
</code></pre>
</div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> [<span class="st">'hội'</span>, <span class="st">'cư'</span>, <span class="st">'dân'</span>, <span class="st">'chung'</span>, <span class="st">'cư'</span>, <span class="st">'sen'</span>, <span class="st">'hồng'</span>, <span class="st">'-'</span>, <span class="st">'chung'</span>, <span class="st">'cư'</span>, <span class="st">'lotus'</span>, <span class="st">'sóng'</span>, <span class="st">'thần'</span>, <span class="st">'thủ'</span>, <span class="st">'đức'</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tokenizer_explain(inp,tokenizer,split_word<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Tokenizer Explained -----
--- Input ---
['hội', 'cư', 'dân', 'chung', 'cư', 'sen', 'hồng', '-', 'chung', 'cư', 'lotus', 'sóng', 'thần', 'thủ', 'đức']

--- Tokenized results --- 
{'input_ids': [0, 227, 1033, 191, 664, 1033, 7366, 2615, 13, 664, 1033, 671, 1355, 2294, 993, 413, 2900, 2], 'token_type_ids': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

--- Results from tokenizer.convert_ids_to_tokens ---
['&lt;s&gt;', '▁hội', '▁cư', '▁dân', '▁chung', '▁cư', '▁sen', '▁hồng', '▁-', '▁chung', '▁cư', '▁lot', 'us', '▁sóng', '▁thần', '▁thủ', '▁đức', '&lt;/s&gt;']

--- Results from tokenizer.decode --- 
&lt;s&gt; ▁hội ▁cư ▁dân ▁chung ▁cư ▁sen ▁hồng ▁- ▁chung ▁cư ▁lot us ▁sóng ▁thần ▁thủ ▁đức &lt;/s&gt;
</code></pre>
</div>
</div>
<p>Now let’s try PhoBert tokenizer. PhoBert tokenizer, unlike Envibert tokenizer, requires input to be word tokenized (using UnderTheSea library)</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"vinai/phobert-base"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</code></pre>
</div>
</div>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> apply_word_tokenize(<span class="st">'hội cư dân chung cư sen hồng - chung cư lotus sóng thần thủ đức'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức</code></pre>
</div>
</div>
<div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tokenizer_explain(inp,tokenizer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Tokenizer Explained -----
--- Input ---
hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức

--- Tokenized results --- 
{'input_ids': [0, 1093, 1838, 1574, 3330, 2025, 31, 1574, 2029, 4885, 8554, 25625, 7344, 2], 'token_type_ids': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

--- Results from tokenizer.convert_ids_to_tokens ---
['&lt;s&gt;', 'hội', 'cư_dân', 'chung_cư', 'sen', 'hồng', '-', 'chung_cư', 'lo@@', 'tus', 'sóng_thần', 'thủ_@@', 'đức', '&lt;/s&gt;']

--- Results from tokenizer.decode --- 
&lt;s&gt; hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức &lt;/s&gt;
</code></pre>
</div>
</div>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> two_steps_tokenization_explain(inp, <span class="co"># Input sentence</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                   tokenizer, <span class="co"># Tokenizer (preferably from HuggingFace)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                   split_word<span class="op">=</span><span class="va">False</span>, <span class="co"># Is input `inp` split into list or not</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                   content_tfms<span class="op">=</span>[] <span class="co"># A list of text transformations</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                  ):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Display results form each content transformation, then display results from tokenizer"</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'----- Text Transformation Explained -----'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'--- Raw sentence ---'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(inp)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tfm <span class="kw">in</span> content_tfms:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        print_msg(callable_name(tfm),<span class="dv">3</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        inp <span class="op">=</span> tfm(inp)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(inp)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    tokenizer_explain(inp,tokenizer,split_word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L41" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="two_steps_tokenization_explain" class="level3">
<h3 class="anchored" data-anchor-id="two_steps_tokenization_explain">two_steps_tokenization_explain</h3>
<blockquote class="blockquote">
<pre><code> two_steps_tokenization_explain (inp, tokenizer, split_word=False,
                                 content_tfms=[])</code></pre>
</blockquote>
<p>Display results form each content transformation, then display results from tokenizer</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inp</td>
<td></td>
<td></td>
<td>Input sentence</td>
</tr>
<tr class="even">
<td>tokenizer</td>
<td></td>
<td></td>
<td>Tokenizer (preferably from HuggingFace)</td>
</tr>
<tr class="odd">
<td>split_word</td>
<td>bool</td>
<td>False</td>
<td>Is input <code>inp</code> split into list or not</td>
</tr>
<tr class="even">
<td>content_tfms</td>
<td>list</td>
<td>[]</td>
<td>A list of text transformations</td>
</tr>
</tbody>
</table>
<p>Let’s load Phobert tokenizer one more time to test out this function</p>
<div id="cell-22" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"vinai/phobert-base"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</code></pre>
</div>
</div>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> underthesea <span class="im">import</span> text_normalize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> <span class="st">'Hội cư dân   chung cư sen hồng- chung cư    lotus sóng thần thủ đức'</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>two_steps_tokenization_explain(inp,tokenizer,content_tfms<span class="op">=</span>[text_normalize,apply_word_tokenize])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Text Transformation Explained -----
--- Raw sentence ---
Hội cư dân   chung cư sen hồng- chung cư    lotus sóng thần thủ đức
--- text_normalize ---
Hội cư dân chung cư sen hồng - chung cư lotus sóng thần thủ đức
--- apply_word_tokenize ---
Hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức

----- Tokenizer Explained -----
--- Input ---
Hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức

--- Tokenized results --- 
{'input_ids': [0, 792, 1838, 1574, 3330, 2025, 31, 1574, 2029, 4885, 8554, 25625, 7344, 2], 'token_type_ids': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

--- Results from tokenizer.convert_ids_to_tokens ---
['&lt;s&gt;', 'Hội', 'cư_dân', 'chung_cư', 'sen', 'hồng', '-', 'chung_cư', 'lo@@', 'tus', 'sóng_thần', 'thủ_@@', 'đức', '&lt;/s&gt;']

--- Results from tokenizer.decode --- 
&lt;s&gt; Hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức &lt;/s&gt;
</code></pre>
</div>
</div>
<p>This is a bit redundant, as <code>apply_word_tokenize</code> also have an option to normalize text. Let’s shorten the code:</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> <span class="st">'Hội cư dân   chung cư sen hồng- chung cư    lotus sóng thần thủ đức'</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>two_steps_tokenization_explain(inp,tokenizer,content_tfms<span class="op">=</span>[partial(apply_word_tokenize,normalize_text<span class="op">=</span><span class="va">True</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Text Transformation Explained -----
--- Raw sentence ---
Hội cư dân   chung cư sen hồng- chung cư    lotus sóng thần thủ đức
--- apply_word_tokenize ---
Hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức

----- Tokenizer Explained -----
--- Input ---
Hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức

--- Tokenized results --- 
{'input_ids': [0, 792, 1838, 1574, 3330, 2025, 31, 1574, 2029, 4885, 8554, 25625, 7344, 2], 'token_type_ids': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

--- Results from tokenizer.convert_ids_to_tokens ---
['&lt;s&gt;', 'Hội', 'cư_dân', 'chung_cư', 'sen', 'hồng', '-', 'chung_cư', 'lo@@', 'tus', 'sóng_thần', 'thủ_@@', 'đức', '&lt;/s&gt;']

--- Results from tokenizer.decode --- 
&lt;s&gt; Hội cư_dân chung_cư sen hồng - chung_cư lotus sóng_thần thủ_đức &lt;/s&gt;
</code></pre>
</div>
</div>
</section>
</section>
<section id="datasetdict" class="level2">
<h2 class="anchored" data-anchor-id="datasetdict">DatasetDict</h2>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tokenize_function(examples:<span class="bu">dict</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                      tok,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                      max_length<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                      is_split_into_words<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_length <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pad to model's default max sequence length</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tok(examples[<span class="st">"text"</span>], padding<span class="op">=</span><span class="st">"max_length"</span>, truncation<span class="op">=</span><span class="va">True</span>,is_split_into_words<span class="op">=</span>is_split_into_words)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(max_length,<span class="bu">int</span>) <span class="kw">and</span> max_length<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pad to max length of the current batch, and start truncating at max_length</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tok(examples[<span class="st">"text"</span>], padding<span class="op">=</span><span class="va">True</span>, max_length<span class="op">=</span>max_length,truncation<span class="op">=</span><span class="va">True</span>,is_split_into_words<span class="op">=</span>is_split_into_words)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no padding (still truncate at model's default max sequence length)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tok(examples[<span class="st">"text"</span>], truncation<span class="op">=</span><span class="va">True</span>,is_split_into_words<span class="op">=</span>is_split_into_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> datasetdictize_given_idxs(kv_pairs:<span class="bu">dict</span>, <span class="co"># Dictionary; keys can be content, label, metadata. Values are list each.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                              trn_idx<span class="op">=</span><span class="va">None</span>, <span class="co"># Training indices</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                              val_idx<span class="op">=</span><span class="va">None</span>, <span class="co"># Validation indices</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                              tokenizer<span class="op">=</span><span class="va">None</span>, <span class="co"># HuggingFace tokenizer</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                              is_split_into_words<span class="op">=</span><span class="va">False</span>, <span class="co"># Is text (content) split into list or not</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                              max_length<span class="op">=</span><span class="va">None</span> <span class="co"># pad to model's allowed max length (default is max_sequence_length)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                             ):</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Create a HuggingFace DatasetDict with given arguments"</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'text'</span> <span class="kw">not</span> <span class="kw">in</span> kv_pairs.keys():</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Dictionary must have `text` (which contains texture contents) as key'</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    all_dataset <span class="op">=</span> Dataset.from_dict(kv_pairs)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    main_ddict <span class="op">=</span> DatasetDict()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> trn_idx <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        main_ddict[<span class="st">'train'</span>] <span class="op">=</span> all_dataset</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        main_ddict[<span class="st">'train'</span>] <span class="op">=</span> all_dataset.select(trn_idx)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val_idx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:  </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        main_ddict[<span class="st">'validation'</span>] <span class="op">=</span> all_dataset.select(val_idx)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    print_msg(<span class="st">"Map Tokenize Function"</span>,<span class="dv">20</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    main_ddict_tokenized <span class="op">=</span> main_ddict.<span class="bu">map</span>(partial(tokenize_function,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                                                  tok<span class="op">=</span>tokenizer,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                                                  is_split_into_words<span class="op">=</span>is_split_into_words,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>                                                  max_length<span class="op">=</span>max_length),batched<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> main_ddict_tokenized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L67" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="datasetdictize_given_idxs" class="level3">
<h3 class="anchored" data-anchor-id="datasetdictize_given_idxs">datasetdictize_given_idxs</h3>
<blockquote class="blockquote">
<pre><code> datasetdictize_given_idxs (kv_pairs:dict, trn_idx=None, val_idx=None,
                            tokenizer=None, is_split_into_words=False,
                            max_length=None)</code></pre>
</blockquote>
<p>Create a HuggingFace DatasetDict with given arguments</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>kv_pairs</td>
<td>dict</td>
<td></td>
<td>Dictionary; keys can be content, label, metadata. Values are list each.</td>
</tr>
<tr class="even">
<td>trn_idx</td>
<td>NoneType</td>
<td>None</td>
<td>Training indices</td>
</tr>
<tr class="odd">
<td>val_idx</td>
<td>NoneType</td>
<td>None</td>
<td>Validation indices</td>
</tr>
<tr class="even">
<td>tokenizer</td>
<td>NoneType</td>
<td>None</td>
<td>HuggingFace tokenizer</td>
</tr>
<tr class="odd">
<td>is_split_into_words</td>
<td>bool</td>
<td>False</td>
<td>Is text (content) split into list or not</td>
</tr>
<tr class="even">
<td>max_length</td>
<td>NoneType</td>
<td>None</td>
<td>pad to model’s allowed max length (default is max_sequence_length)</td>
</tr>
</tbody>
</table>
<p>Example</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cache_dir<span class="op">=</span>Path(<span class="st">'./envibert_tokenizer'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> SourceFileLoader(<span class="st">"envibert.tokenizer"</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                             <span class="bu">str</span>(cache_dir<span class="op">/</span><span class="st">'envibert_tokenizer.py'</span>)).load_module().RobertaTokenizer(cache_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>kv_pairs<span class="op">=</span>{</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'text'</span>:[</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">'hội cư dân chung cư sen hồng - chung cư lotus sóng thần thủ đức'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">'This is the recommended way to make a Python package importable from anywhere'</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">'hội cần mở thẻ tín dụng tại hà nội, đà nẵng, tp. hồ chí minh'</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"biti's cao lãnh - đồng tháp"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">'chợ phòng trọ + việc làm...khu lĩnh nam - vĩnh hưng - mai động (hoàng mai)'</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>          ],</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'label'</span>: [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>ddict <span class="op">=</span> datasetdictize_given_idxs(kv_pairs,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                                  trn_idx<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>],</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>                                  val_idx<span class="op">=</span>[<span class="dv">2</span>,<span class="dv">4</span>],</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>                                  tokenizer<span class="op">=</span>tokenizer,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>                                  max_length<span class="op">=</span><span class="dv">512</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------------- Map Tokenize Function --------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ddict.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>dict_keys(['train', 'validation'])</code></pre>
</div>
</div>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ddict[<span class="st">'train'</span>][<span class="st">'input_ids'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0, 227, 1033, 191, 664, 1033, 7366, 2615, 13, 664, 1033, 671, 1355, 2294, 993, 413, 2900, 2], [0, 116, 14, 6, 3169, 270, 9, 364, 10, 23963, 5360, 15930, 2003, 51, 5906, 2, 1, 1], [0, 880, 592, 427, 162, 171, 906, 13, 122, 6553, 2, 1, 1, 1, 1, 1, 1, 1]]</code></pre>
</div>
</div>
<p>You can change max_length (which allow truncation when sentence length is higher than max_length)</p>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ddict <span class="op">=</span> datasetdictize_given_idxs(kv_pairs,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                                  trn_idx<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>],</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                                  val_idx<span class="op">=</span>[<span class="dv">2</span>,<span class="dv">4</span>],</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                                  tokenizer<span class="op">=</span>tokenizer,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                                  max_length<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------------- Map Tokenize Function --------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ddict[<span class="st">'train'</span>][<span class="st">'input_ids'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0, 227, 1033, 191, 2], [0, 116, 14, 6, 2], [0, 880, 592, 427, 2]]</code></pre>
</div>
</div>
<p>Allow full dataset to be mapped to DatasetDict if we omit trn_idx argument</p>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ddict <span class="op">=</span> datasetdictize_given_idxs(kv_pairs,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                                  tokenizer<span class="op">=</span>tokenizer,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                  max_length<span class="op">=</span><span class="dv">512</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------------- Map Tokenize Function --------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ddict[<span class="st">'train'</span>][<span class="st">'input_ids'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[0, 227, 1033, 191, 664, 1033, 7366, 2615, 13, 664, 1033, 671, 1355, 2294, 993, 413, 2900, 2, 1, 1, 1, 1, 1, 1, 1], [0, 116, 14, 6, 3169, 270, 9, 364, 10, 23963, 5360, 15930, 2003, 51, 5906, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 227, 256, 778, 2600, 1074, 144, 76, 5489, 613, 57339, 4820, 27666, 57339, 21422, 244, 872, 635, 841, 2, 1, 1, 1, 1, 1], [0, 880, 592, 427, 162, 171, 906, 13, 122, 6553, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], [0, 2299, 315, 5995, 1349, 99, 83, 55025, 244, 6356, 1114, 1213, 1163, 13, 8233, 11051, 13, 3335, 109, 28, 11695, 13377, 3335, 3, 2]]</code></pre>
</div>
</div>
</section>
</section>
<section id="class-textdatamain" class="level2">
<h2 class="anchored" data-anchor-id="class-textdatamain">Class TextDataMain</h2>
<div id="cell-44" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TextDataMain():</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 df: pd.DataFrame, <span class="co"># The main dataframe</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                 main_content:<span class="bu">str</span>, <span class="co"># Name of the text column</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                 metadatas<span class="op">=</span>[], <span class="co"># Names of the metadata columns</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                 label_names<span class="op">=</span><span class="va">None</span>, <span class="co"># Names of the label (dependent variable) columns</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                 class_names_predefined<span class="op">=</span><span class="va">None</span>, <span class="co"># (Optional) List of names associated with the labels (same index order)</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                 val_ratio:<span class="bu">list</span><span class="op">|</span><span class="bu">float</span><span class="op">|</span><span class="va">None</span><span class="op">=</span><span class="fl">0.2</span>, <span class="co"># Ratio of data for validation set. If given a list, validation set will be chosen based on indices in this list</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                 split_cols:<span class="bu">list</span><span class="op">|</span><span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Column(s) needed to do stratified shuffle split</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                 content_tfms<span class="op">=</span>[], <span class="co"># A list of text transformations</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                 aug_tfms<span class="op">=</span>[], <span class="co"># A list of text augmentations</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                 process_metadatas<span class="op">=</span><span class="va">True</span>, <span class="co"># Whether to do simmple text processing on the chosen metadatas</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                 seed<span class="op">=</span><span class="va">None</span>, <span class="co"># Random seed</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                 cols_to_keep<span class="op">=</span><span class="va">None</span>, <span class="co"># Columns to keep after all processings</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                 shuffle_trn<span class="op">=</span><span class="va">True</span> <span class="co"># Whether to shuffle the train set</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>                ):</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df.copy()</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.main_content <span class="op">=</span> main_content</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.metadatas <span class="op">=</span> metadatas</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label_names <span class="op">=</span> label_names</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label_lists <span class="op">=</span> class_names_predefined</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_tfms <span class="op">=</span> content_tfms</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.aug_tfms <span class="op">=</span> aug_tfms</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.process_metadatas <span class="op">=</span> process_metadatas</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.val_ratio<span class="op">=</span>val_ratio</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.split_cols<span class="op">=</span>split_cols</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.seed <span class="op">=</span> seed</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cols_to_keep <span class="op">=</span> cols_to_keep</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.shuffle_trn<span class="op">=</span>shuffle_trn  </span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._main_called<span class="op">=</span><span class="va">False</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.is_multilabel<span class="op">=</span><span class="va">False</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.is_multihead<span class="op">=</span><span class="va">False</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        check_input_validation(<span class="va">self</span>.df)</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> from_csv(cls,path,return_df<span class="op">=</span><span class="va">False</span>,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>,<span class="op">**</span>kwargs):</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(path,encoding<span class="op">=</span>encoding,engine<span class="op">=</span><span class="st">'pyarrow'</span>)</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>        tdm <span class="op">=</span> TextDataMain(df,main_content<span class="op">=</span><span class="va">None</span>) <span class="cf">if</span> return_df <span class="cf">else</span> TextDataMain(df,<span class="op">**</span>kwargs)</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> return_df:</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tdm</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> from_pickle(cls,</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>                    fname, <span class="co"># Name of the pickle file</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>                    parent<span class="op">=</span><span class="st">'pickle_files'</span> <span class="co"># Parent folder</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>                   ):</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> load_pickle(fname,parent<span class="op">=</span>parent)</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> from_gsheet(cls,gs_id,return_df<span class="op">=</span><span class="va">False</span>,<span class="op">**</span>kwargs):</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_as_pickles(<span class="va">self</span>,</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>                        fname, <span class="co"># Name of the pickle file</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>                        parent<span class="op">=</span><span class="st">'pickle_files'</span>, <span class="co"># Parent folder</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>                        drop_data_attributes<span class="op">=</span><span class="va">False</span> <span class="co"># Whether to drop all large-size data attributes</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>                       ):</span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> drop_data_attributes:</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>, <span class="st">'df'</span>):</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>                <span class="kw">del</span> <span class="va">self</span>.df</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>, <span class="st">'main_ddict'</span>):</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>                <span class="kw">del</span> <span class="va">self</span>.main_ddict</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>        save_to_pickle(<span class="va">self</span>,fname,parent<span class="op">=</span>parent)</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _check_validation_leaking(<span class="va">self</span>,trn_idxs,val_idxs):</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.val_ratio <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> trn_idxs,<span class="va">None</span></span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>        df_trn <span class="op">=</span> <span class="va">self</span>.df.loc[trn_idxs]</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>        df_val <span class="op">=</span> <span class="va">self</span>.df.loc[val_idxs]</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">#sanity check</span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> df_trn.shape[<span class="dv">0</span>]<span class="op">+</span>df_val.shape[<span class="dv">0</span>]<span class="op">==</span><span class="va">self</span>.df.shape[<span class="dv">0</span>],<span class="st">"Train + Validation != Total Data"</span></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Previous Validation Percentage: </span><span class="sc">{</span><span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span><span class="bu">len</span>(val_idxs)<span class="op">/</span><span class="va">self</span>.df.shape[<span class="dv">0</span>],<span class="dv">3</span>)<span class="sc">}</span><span class="ss">%'</span>)</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>        val_content_series <span class="op">=</span> check_text_leaking(df_trn[<span class="va">self</span>.main_content],df_val[<span class="va">self</span>.main_content])</span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>        val_idxs2 <span class="op">=</span> val_content_series.index.values</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>        trn_idxs2 <span class="op">=</span> <span class="va">self</span>.df[<span class="op">~</span><span class="va">self</span>.df.index.isin(val_idxs2)].index.values</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Current Validation Percentage: </span><span class="sc">{</span><span class="bu">round</span>(<span class="dv">100</span><span class="op">*</span><span class="bu">len</span>(val_idxs2)<span class="op">/</span><span class="va">self</span>.df.shape[<span class="dv">0</span>],<span class="dv">3</span>)<span class="sc">}</span><span class="ss">%'</span>)</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(val_idxs2)<span class="op">!=</span><span class="bu">len</span>(val_idxs):</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> trn_idxs2,val_idxs2</span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> trn_idxs,val_idxs</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _train_test_split(<span class="va">self</span>):</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Train Test Split'</span>,<span class="dv">20</span>)</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>        rng <span class="op">=</span> np.random.default_rng(<span class="va">self</span>.seed)</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.val_ratio <span class="kw">is</span> <span class="va">None</span>: <span class="co"># no train/val split</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>            trn_idxs <span class="op">=</span> rng.permutation(<span class="va">self</span>.df.shape[<span class="dv">0</span>])</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> trn_idxs,<span class="va">None</span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.val_ratio,<span class="bu">list</span>) <span class="kw">or</span> <span class="bu">isinstance</span>(<span class="va">self</span>.val_ratio,np.ndarray):</span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>            val_idxs <span class="op">=</span> np.array(<span class="va">self</span>.val_ratio)</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>            trn_idxs <span class="op">=</span> np.array(<span class="bu">set</span>(<span class="va">self</span>.df.index.values) <span class="op">-</span> <span class="bu">set</span>(<span class="va">self</span>.val_ratio))</span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> trn_idxs,val_idxs</span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.val_ratio,<span class="bu">float</span>) <span class="kw">and</span> <span class="va">self</span>.split_cols <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>            _idxs <span class="op">=</span> rng.permutation(<span class="va">self</span>.df.shape[<span class="dv">0</span>])</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>            _cutoff <span class="op">=</span> <span class="bu">int</span>(<span class="va">self</span>.val_ratio<span class="op">*</span><span class="va">self</span>.df.shape[<span class="dv">0</span>]) </span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>            val_idxs <span class="op">=</span> _idxs[:_cutoff]</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>            trn_idxs <span class="op">=</span> _idxs[_cutoff:]</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> trn_idxs,val_idxs</span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.split_cols <span class="op">=</span> val2iterable(<span class="va">self</span>.split_cols)</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.is_multilabel <span class="kw">and</span> <span class="va">self</span>.label_names[<span class="dv">0</span>] <span class="kw">in</span> <span class="va">self</span>.split_cols:</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'For MultiLabel classification, you cannot choose the label as your shuffle-split column'</span>)</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.split_cols)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>            _y <span class="op">=</span> <span class="va">self</span>.df[<span class="va">self</span>.split_cols[<span class="dv">0</span>]]</span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.split_cols)<span class="op">&gt;</span><span class="dv">1</span>:</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> c <span class="kw">in</span> <span class="va">self</span>.split_cols[<span class="dv">1</span>:]:</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>                    _y<span class="op">=</span> _y.astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> <span class="va">self</span>.df[c].astype(<span class="bu">str</span>)</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>            sss <span class="op">=</span> StratifiedShuffleSplit(n_splits<span class="op">=</span><span class="dv">1</span>, test_size<span class="op">=</span><span class="va">self</span>.val_ratio, </span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>                                         random_state<span class="op">=</span><span class="va">self</span>.seed)</span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>            trn_idxs,val_idxs <span class="op">=</span> <span class="bu">list</span>(sss.split(<span class="va">self</span>.df,_y))[<span class="dv">0</span>]</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> trn_idxs,val_idxs</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'No valid keyword arguments for train validation split!'</span>)</span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _encode_labels(<span class="va">self</span>):</span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Label Encoding'</span>)</span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.label_names <span class="kw">is</span> <span class="va">None</span>: </span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Missing label columns!'</span>)</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label_names <span class="op">=</span> val2iterable(<span class="va">self</span>.label_names)</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.label_names)<span class="op">&gt;</span><span class="dv">1</span>:</span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.is_multihead<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.label_lists <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="kw">not</span> <span class="bu">isinstance</span>(<span class="va">self</span>.label_lists[<span class="dv">0</span>],<span class="bu">list</span>):</span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.label_lists <span class="op">=</span> [<span class="va">self</span>.label_lists]</span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="va">self</span>.df[<span class="va">self</span>.label_names[<span class="dv">0</span>]].iloc[<span class="dv">0</span>],<span class="bu">list</span>):</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a>            <span class="co"># This is multi-label. Ignore self.label_names[1:]</span></span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.label_names <span class="op">=</span> [<span class="va">self</span>.label_names[<span class="dv">0</span>]]</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.is_multihead<span class="op">=</span><span class="va">False</span></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.is_multilabel<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a>        encoder_classes<span class="op">=</span>[]</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.is_multilabel:</span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> idx,l <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.label_names):</span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.label_lists <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a>                    train_label <span class="op">=</span> <span class="va">self</span>.df[l].values</span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a>                    l_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.df[l] <span class="op">=</span> l_encoder.fit_transform(train_label)</span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a>                    encoder_classes.append(<span class="bu">list</span>(l_encoder.classes_))</span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a>                    l_classes <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">list</span>(<span class="va">self</span>.label_lists[idx]))</span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a>                    label2idx <span class="op">=</span> {v:i <span class="cf">for</span> i,v <span class="kw">in</span> <span class="bu">enumerate</span>(l_classes)}</span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.df[l] <span class="op">=</span> <span class="va">self</span>.df[l].<span class="bu">map</span>(label2idx).values</span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a>                    encoder_classes.append(l_classes)</span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For MultiLabel, we only save the encoder classes without transforming the label itself to one-hot (or actually, few-hot)</span></span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.label_lists <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a>                l_encoder <span class="op">=</span> MultiLabelBinarizer()</span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a>                _ <span class="op">=</span> l_encoder.fit(<span class="va">self</span>.df[<span class="va">self</span>.label_names[<span class="dv">0</span>]])</span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a>                encoder_classes.append(<span class="bu">list</span>(l_encoder.classes_))</span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a>                l_classes <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">list</span>(<span class="va">self</span>.label_lists[<span class="dv">0</span>]))</span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a>                encoder_classes.append(l_classes)</span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label_lists <span class="op">=</span> encoder_classes</span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _process_metadatas(<span class="va">self</span>,df,override_dict<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Metadata Simple Processing &amp; Concatenating to Main Content'</span>)</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.metadatas <span class="op">=</span> val2iterable(<span class="va">self</span>.metadatas)</span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.metadatas:</span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.process_metadatas:</span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a>                <span class="co"># just strip and lowercase</span></span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a>                df[s] <span class="op">=</span> df[s].astype(<span class="bu">str</span>).<span class="bu">str</span>.strip().<span class="bu">str</span>.lower()</span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a>            <span class="co"># simple concatenation with '. '</span></span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a>            df[<span class="va">self</span>.main_content] <span class="op">=</span> df[s] <span class="op">+</span> <span class="st">' - '</span> <span class="op">+</span> df[<span class="va">self</span>.main_content]</span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> override_dict:        </span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.metadata_dict<span class="op">=</span>{}</span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> s <span class="kw">in</span> <span class="va">self</span>.metadatas:</span>
<span id="cb47-178"><a href="#cb47-178" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.metadata_dict[s]<span class="op">=</span><span class="bu">sorted</span>(<span class="bu">set</span>(df[s].values))</span>
<span id="cb47-179"><a href="#cb47-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _simplify_df(<span class="va">self</span>):</span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.cols_to_keep <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.cols_to_keep<span class="op">=</span> [<span class="va">self</span>.main_content] <span class="op">+</span> <span class="va">self</span>.metadatas <span class="op">+</span> <span class="va">self</span>.label_names</span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> <span class="va">self</span>.df[<span class="va">self</span>.cols_to_keep].copy()</span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _do_transformation(<span class="va">self</span>,df):</span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Text Transformation'</span>,<span class="dv">20</span>)</span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tfm <span class="kw">in</span> <span class="va">self</span>.content_tfms:</span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a>            print_msg(callable_name(tfm))</span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a>            df[<span class="va">self</span>.main_content] <span class="op">=</span> [tfm(s) <span class="cf">for</span> s <span class="kw">in</span> tqdm(df[<span class="va">self</span>.main_content].values)]</span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _do_augmentation(<span class="va">self</span>,df_trn_org):</span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a>        df_trn_all <span class="op">=</span> df_trn_org.copy()</span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Text Augmentation'</span>,<span class="dv">20</span>)</span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Train data size before augmentation: </span><span class="sc">{</span><span class="bu">len</span>(df_trn_all)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tfm <span class="kw">in</span> <span class="va">self</span>.aug_tfms:</span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a>            print_msg(callable_name(tfm))</span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tfm.keywords[<span class="st">'apply_to_all'</span>]:</span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a>                new_content,new_others <span class="op">=</span> tfm(content<span class="op">=</span>df_trn_all[<span class="va">self</span>.main_content].values,others<span class="op">=</span>df_trn_all.iloc[:,<span class="dv">1</span>:])</span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a>                new_content,new_others <span class="op">=</span> tfm(content<span class="op">=</span>df_trn_org[<span class="va">self</span>.main_content].values,others<span class="op">=</span>df_trn_org.iloc[:,<span class="dv">1</span>:])</span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a>            <span class="co"># add axis to np array in order to do concatenation</span></span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(new_content.shape)<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a>                new_content <span class="op">=</span> new_content[:,<span class="va">None</span>]</span>
<span id="cb47-207"><a href="#cb47-207" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(new_others.values.shape)<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb47-208"><a href="#cb47-208" aria-hidden="true" tabindex="-1"></a>                new_others <span class="op">=</span> new_others.values[:,<span class="va">None</span>]</span>
<span id="cb47-209"><a href="#cb47-209" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb47-210"><a href="#cb47-210" aria-hidden="true" tabindex="-1"></a>            df_tmp <span class="op">=</span> pd.DataFrame(np.concatenate((new_content,new_others.values),axis<span class="op">=</span><span class="dv">1</span>),columns<span class="op">=</span>df_trn_org.columns.values)</span>
<span id="cb47-211"><a href="#cb47-211" aria-hidden="true" tabindex="-1"></a>            df_trn_all <span class="op">=</span> pd.concat((df_trn_all,df_tmp),axis<span class="op">=</span><span class="dv">0</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-212"><a href="#cb47-212" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Train data size after THIS augmentation: </span><span class="sc">{</span><span class="bu">len</span>(df_trn_all)<span class="sc">}</span><span class="ss">'</span>)       </span>
<span id="cb47-213"><a href="#cb47-213" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Train data size after ALL augmentation: </span><span class="sc">{</span><span class="bu">len</span>(df_trn_all)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-214"><a href="#cb47-214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df_trn_all</span>
<span id="cb47-215"><a href="#cb47-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-216"><a href="#cb47-216" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _main_text_processing(<span class="va">self</span>):</span>
<span id="cb47-217"><a href="#cb47-217" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Start Main Text Processing'</span>,<span class="dv">20</span>)</span>
<span id="cb47-218"><a href="#cb47-218" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-219"><a href="#cb47-219" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process metadatas</span></span>
<span id="cb47-220"><a href="#cb47-220" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> <span class="va">self</span>._process_metadatas(<span class="va">self</span>.df)</span>
<span id="cb47-221"><a href="#cb47-221" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-222"><a href="#cb47-222" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process labels</span></span>
<span id="cb47-223"><a href="#cb47-223" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._encode_labels()</span>
<span id="cb47-224"><a href="#cb47-224" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-225"><a href="#cb47-225" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Content transformation</span></span>
<span id="cb47-226"><a href="#cb47-226" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> <span class="va">self</span>._do_transformation(<span class="va">self</span>.df)</span>
<span id="cb47-227"><a href="#cb47-227" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-228"><a href="#cb47-228" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Train Test Split</span></span>
<span id="cb47-229"><a href="#cb47-229" aria-hidden="true" tabindex="-1"></a>        trn_idxs,val_idxs <span class="op">=</span> <span class="va">self</span>._train_test_split()</span>
<span id="cb47-230"><a href="#cb47-230" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._simplify_df()</span>
<span id="cb47-231"><a href="#cb47-231" aria-hidden="true" tabindex="-1"></a>        trn_idxs,val_idxs <span class="op">=</span> <span class="va">self</span>._check_validation_leaking(trn_idxs,val_idxs)</span>
<span id="cb47-232"><a href="#cb47-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.val_ratio <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb47-233"><a href="#cb47-233" aria-hidden="true" tabindex="-1"></a>            df_val <span class="op">=</span> <span class="va">self</span>.df.loc[val_idxs].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-234"><a href="#cb47-234" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-235"><a href="#cb47-235" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Augmentation</span></span>
<span id="cb47-236"><a href="#cb47-236" aria-hidden="true" tabindex="-1"></a>        df_trn_org <span class="op">=</span> <span class="va">self</span>.df.loc[trn_idxs].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-237"><a href="#cb47-237" aria-hidden="true" tabindex="-1"></a>        df_trn_all <span class="op">=</span> <span class="va">self</span>._do_augmentation(df_trn_org)</span>
<span id="cb47-238"><a href="#cb47-238" aria-hidden="true" tabindex="-1"></a>        df_trn_all[<span class="st">'is_valid'</span>]<span class="op">=</span><span class="va">False</span></span>
<span id="cb47-239"><a href="#cb47-239" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-240"><a href="#cb47-240" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Shuffle train</span></span>
<span id="cb47-241"><a href="#cb47-241" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.shuffle_trn:</span>
<span id="cb47-242"><a href="#cb47-242" aria-hidden="true" tabindex="-1"></a>            df_trn_all <span class="op">=</span> df_trn_all.sample(frac<span class="op">=</span><span class="fl">1.</span>,random_state<span class="op">=</span><span class="va">self</span>.seed)</span>
<span id="cb47-243"><a href="#cb47-243" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-244"><a href="#cb47-244" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine augmented train and val</span></span>
<span id="cb47-245"><a href="#cb47-245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.val_ratio <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb47-246"><a href="#cb47-246" aria-hidden="true" tabindex="-1"></a>            df_val[<span class="st">'is_valid'</span>]<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-247"><a href="#cb47-247" aria-hidden="true" tabindex="-1"></a>            df_trn_all <span class="op">=</span> pd.concat((df_trn_all,df_val),axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb47-248"><a href="#cb47-248" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-249"><a href="#cb47-249" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._main_called<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-250"><a href="#cb47-250" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df_trn_all.reset_index(drop<span class="op">=</span><span class="va">True</span>)        </span>
<span id="cb47-251"><a href="#cb47-251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-252"><a href="#cb47-252" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_data_collator(<span class="va">self</span>,data_collator):</span>
<span id="cb47-253"><a href="#cb47-253" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_collator <span class="op">=</span> data_collator</span>
<span id="cb47-254"><a href="#cb47-254" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-255"><a href="#cb47-255" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> tokenizer_explain_single(<span class="va">self</span>,tokenizer):</span>
<span id="cb47-256"><a href="#cb47-256" aria-hidden="true" tabindex="-1"></a>        inp <span class="op">=</span> <span class="va">self</span>.df[<span class="op">~</span><span class="va">self</span>.df[<span class="st">'is_valid'</span>]][<span class="va">self</span>.main_content].sample(<span class="dv">1</span>).values[<span class="dv">0</span>]</span>
<span id="cb47-257"><a href="#cb47-257" aria-hidden="true" tabindex="-1"></a>        tokenizer_explain(inp,tokenizer)</span>
<span id="cb47-258"><a href="#cb47-258" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-259"><a href="#cb47-259" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_df(<span class="va">self</span>): </span>
<span id="cb47-260"><a href="#cb47-260" aria-hidden="true" tabindex="-1"></a>        <span class="co">"To execute all the defined processings and return a dataframe"</span></span>
<span id="cb47-261"><a href="#cb47-261" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._main_called:</span>
<span id="cb47-262"><a href="#cb47-262" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._main_text_processing()</span>
<span id="cb47-263"><a href="#cb47-263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.df</span>
<span id="cb47-264"><a href="#cb47-264" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb47-265"><a href="#cb47-265" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_train_data_after_processing(<span class="va">self</span>,output_path,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>):</span>
<span id="cb47-266"><a href="#cb47-266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._main_called:</span>
<span id="cb47-267"><a href="#cb47-267" aria-hidden="true" tabindex="-1"></a>            print_msg(<span class="st">'WARNING'</span>)</span>
<span id="cb47-268"><a href="#cb47-268" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Please process training data (using to_df or to_datasetdict)'</span>)</span>
<span id="cb47-269"><a href="#cb47-269" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb47-270"><a href="#cb47-270" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df.to_csv(Path(output_path),encoding<span class="op">=</span>encoding,index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-271"><a href="#cb47-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-272"><a href="#cb47-272" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_datasetdict(<span class="va">self</span>,</span>
<span id="cb47-273"><a href="#cb47-273" aria-hidden="true" tabindex="-1"></a>                       tokenizer, <span class="co"># Tokenizer (preferably from HuggingFace)</span></span>
<span id="cb47-274"><a href="#cb47-274" aria-hidden="true" tabindex="-1"></a>                       is_split_into_words<span class="op">=</span><span class="va">False</span>, <span class="co"># Is text split into list or not</span></span>
<span id="cb47-275"><a href="#cb47-275" aria-hidden="true" tabindex="-1"></a>                       max_length<span class="op">=</span><span class="va">None</span>, <span class="co"># pad to model's allowed max length (default is max_sequence_length)</span></span>
<span id="cb47-276"><a href="#cb47-276" aria-hidden="true" tabindex="-1"></a>                       trn_ratio<span class="op">=</span><span class="fl">1.</span>, <span class="co"># Portion of training data to be converted to datasetdict. Useful for sample experiments</span></span>
<span id="cb47-277"><a href="#cb47-277" aria-hidden="true" tabindex="-1"></a>                       seed<span class="op">=</span><span class="dv">42</span> <span class="co"># Random seed</span></span>
<span id="cb47-278"><a href="#cb47-278" aria-hidden="true" tabindex="-1"></a>                      ):</span>
<span id="cb47-279"><a href="#cb47-279" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._main_called:</span>
<span id="cb47-280"><a href="#cb47-280" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._main_text_processing()</span>
<span id="cb47-281"><a href="#cb47-281" aria-hidden="true" tabindex="-1"></a>        val_idx <span class="op">=</span> <span class="va">self</span>.df[<span class="va">self</span>.df[<span class="st">'is_valid'</span>]].index.values <span class="cf">if</span> <span class="va">self</span>.val_ratio <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb47-282"><a href="#cb47-282" aria-hidden="true" tabindex="-1"></a>        trn_idx <span class="op">=</span> <span class="va">self</span>.df[<span class="op">~</span><span class="va">self</span>.df[<span class="st">'is_valid'</span>]].index.values</span>
<span id="cb47-283"><a href="#cb47-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> trn_ratio<span class="op">&lt;</span><span class="fl">1.</span> <span class="kw">and</span> trn_ratio<span class="op">&gt;</span><span class="fl">0.</span>:</span>
<span id="cb47-284"><a href="#cb47-284" aria-hidden="true" tabindex="-1"></a>            rng <span class="op">=</span> np.random.default_rng(<span class="va">self</span>.seed)</span>
<span id="cb47-285"><a href="#cb47-285" aria-hidden="true" tabindex="-1"></a>            _idxs <span class="op">=</span> rng.permutation(<span class="bu">len</span>(trn_idx))</span>
<span id="cb47-286"><a href="#cb47-286" aria-hidden="true" tabindex="-1"></a>            _cutoff <span class="op">=</span> <span class="bu">int</span>(trn_ratio<span class="op">*</span><span class="bu">len</span>(trn_idx)) </span>
<span id="cb47-287"><a href="#cb47-287" aria-hidden="true" tabindex="-1"></a>            trn_idx <span class="op">=</span> _idxs[:_cutoff]</span>
<span id="cb47-288"><a href="#cb47-288" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-289"><a href="#cb47-289" aria-hidden="true" tabindex="-1"></a>        _label <span class="op">=</span> <span class="va">self</span>.df[<span class="va">self</span>.label_names].values.tolist()</span>
<span id="cb47-290"><a href="#cb47-290" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.is_multilabel:</span>
<span id="cb47-291"><a href="#cb47-291" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.label_names)<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb47-292"><a href="#cb47-292" aria-hidden="true" tabindex="-1"></a>                _label <span class="op">=</span> np.array(_label).flatten().tolist() <span class="co"># (n,)</span></span>
<span id="cb47-293"><a href="#cb47-293" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb47-294"><a href="#cb47-294" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For MultiLabel, this is where the actual label transformation happens</span></span>
<span id="cb47-295"><a href="#cb47-295" aria-hidden="true" tabindex="-1"></a>            mlb <span class="op">=</span> MultiLabelBinarizer(classes<span class="op">=</span><span class="va">self</span>.label_lists[<span class="dv">0</span>])</span>
<span id="cb47-296"><a href="#cb47-296" aria-hidden="true" tabindex="-1"></a>            _label <span class="op">=</span> <span class="va">self</span>.df[<span class="va">self</span>.label_names[<span class="dv">0</span>]].values.tolist()</span>
<span id="cb47-297"><a href="#cb47-297" aria-hidden="true" tabindex="-1"></a>            _label <span class="op">=</span> mlb.fit_transform(_label).tolist() <span class="co"># few-hotted</span></span>
<span id="cb47-298"><a href="#cb47-298" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-299"><a href="#cb47-299" aria-hidden="true" tabindex="-1"></a>        kv_pairs <span class="op">=</span> {<span class="st">'text'</span>:<span class="va">self</span>.df[<span class="va">self</span>.main_content].tolist(),</span>
<span id="cb47-300"><a href="#cb47-300" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'label'</span>:_label,</span>
<span id="cb47-301"><a href="#cb47-301" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb47-302"><a href="#cb47-302" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="va">self</span>.cols_to_keep:</span>
<span id="cb47-303"><a href="#cb47-303" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.label_names<span class="op">+</span>[<span class="va">self</span>.main_content]: kv_pairs[c] <span class="op">=</span> <span class="va">self</span>.df[c].tolist()</span>
<span id="cb47-304"><a href="#cb47-304" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-305"><a href="#cb47-305" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokenizer <span class="op">=</span> tokenizer</span>
<span id="cb47-306"><a href="#cb47-306" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.is_split_into_words<span class="op">=</span> is_split_into_words</span>
<span id="cb47-307"><a href="#cb47-307" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_length <span class="op">=</span> max_length</span>
<span id="cb47-308"><a href="#cb47-308" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-309"><a href="#cb47-309" aria-hidden="true" tabindex="-1"></a>        ddict <span class="op">=</span> datasetdictize_given_idxs(kv_pairs,trn_idx,val_idx,<span class="va">self</span>.tokenizer,</span>
<span id="cb47-310"><a href="#cb47-310" aria-hidden="true" tabindex="-1"></a>                                         is_split_into_words<span class="op">=</span>is_split_into_words,max_length<span class="op">=</span>max_length)</span>
<span id="cb47-311"><a href="#cb47-311" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.main_ddict <span class="op">=</span> ddict</span>
<span id="cb47-312"><a href="#cb47-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ddict</span>
<span id="cb47-313"><a href="#cb47-313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-314"><a href="#cb47-314" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_test_datasetdict_from_csv(<span class="va">self</span>,path,encoding<span class="op">=</span><span class="st">'utf-8-sig'</span>):</span>
<span id="cb47-315"><a href="#cb47-315" aria-hidden="true" tabindex="-1"></a>        df_test <span class="op">=</span> pd.read_csv(path,encoding<span class="op">=</span>encoding,engine<span class="op">=</span><span class="st">'pyarrow'</span>)</span>
<span id="cb47-316"><a href="#cb47-316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_test_datasetdict_from_df(df_test)</span>
<span id="cb47-317"><a href="#cb47-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-318"><a href="#cb47-318" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_test_datasetdict_from_dict(<span class="va">self</span>,content):</span>
<span id="cb47-319"><a href="#cb47-319" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.metadatas)<span class="op">!=</span><span class="dv">0</span> <span class="kw">and</span> <span class="kw">not</span> <span class="bu">isinstance</span>(content,<span class="bu">dict</span>):</span>
<span id="cb47-320"><a href="#cb47-320" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f'There is/are metadatas in the preprocessing step. Please include a dictionary including these keys for metadatas: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>metadatas<span class="sc">}</span><span class="ss">, and texture content: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>main_content<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb47-321"><a href="#cb47-321" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb47-322"><a href="#cb47-322" aria-hidden="true" tabindex="-1"></a>        _dic <span class="op">=</span> {<span class="va">self</span>.main_content:[content]} <span class="cf">if</span> <span class="bu">isinstance</span>(content,<span class="bu">str</span>) <span class="cf">else</span> content</span>
<span id="cb47-323"><a href="#cb47-323" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> _dic.keys():</span>
<span id="cb47-324"><a href="#cb47-324" aria-hidden="true" tabindex="-1"></a>            _dic[k] <span class="op">=</span> val2iterable(_dic[k])</span>
<span id="cb47-325"><a href="#cb47-325" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-326"><a href="#cb47-326" aria-hidden="true" tabindex="-1"></a>        df_test <span class="op">=</span> pd.DataFrame.from_dict(_dic)</span>
<span id="cb47-327"><a href="#cb47-327" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_test_datasetdict_from_df(df_test)</span>
<span id="cb47-328"><a href="#cb47-328" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-329"><a href="#cb47-329" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_test_datasetdict_from_df(<span class="va">self</span>,df_test):</span>
<span id="cb47-330"><a href="#cb47-330" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Getting Test Set'</span>,<span class="dv">20</span>)</span>
<span id="cb47-331"><a href="#cb47-331" aria-hidden="true" tabindex="-1"></a>        check_input_validation(df_test)</span>
<span id="cb47-332"><a href="#cb47-332" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-333"><a href="#cb47-333" aria-hidden="true" tabindex="-1"></a>        cols_to_keep <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> <span class="va">self</span>.cols_to_keep <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.label_names]</span>
<span id="cb47-334"><a href="#cb47-334" aria-hidden="true" tabindex="-1"></a>        df_test <span class="op">=</span> df_test[cols_to_keep].copy()</span>
<span id="cb47-335"><a href="#cb47-335" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-336"><a href="#cb47-336" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Start Test Set Transformation'</span>,<span class="dv">20</span>)</span>
<span id="cb47-337"><a href="#cb47-337" aria-hidden="true" tabindex="-1"></a>        df_test <span class="op">=</span> <span class="va">self</span>._process_metadatas(df_test,override_dict<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-338"><a href="#cb47-338" aria-hidden="true" tabindex="-1"></a>        df_test <span class="op">=</span> <span class="va">self</span>._do_transformation(df_test)</span>
<span id="cb47-339"><a href="#cb47-339" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-340"><a href="#cb47-340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>,<span class="st">'df'</span>):</span>
<span id="cb47-341"><a href="#cb47-341" aria-hidden="true" tabindex="-1"></a>            print_msg(<span class="st">'Test Leak Checking'</span>,<span class="dv">20</span>)</span>
<span id="cb47-342"><a href="#cb47-342" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=</span> check_text_leaking(<span class="va">self</span>.df[<span class="va">self</span>.main_content],df_test[<span class="va">self</span>.main_content])</span>
<span id="cb47-343"><a href="#cb47-343" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-344"><a href="#cb47-344" aria-hidden="true" tabindex="-1"></a>        print_msg(<span class="st">'Construct DatasetDict'</span>,<span class="dv">20</span>)</span>
<span id="cb47-345"><a href="#cb47-345" aria-hidden="true" tabindex="-1"></a>        test_text <span class="op">=</span> df_test[<span class="va">self</span>.main_content].values</span>
<span id="cb47-346"><a href="#cb47-346" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-347"><a href="#cb47-347" aria-hidden="true" tabindex="-1"></a>        kv_pairs <span class="op">=</span>{<span class="st">'text'</span>:test_text}</span>
<span id="cb47-348"><a href="#cb47-348" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> <span class="va">self</span>.cols_to_keep:</span>
<span id="cb47-349"><a href="#cb47-349" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.label_names<span class="op">+</span>[<span class="va">self</span>.main_content]: kv_pairs[c] <span class="op">=</span> df_test[c].tolist()</span>
<span id="cb47-350"><a href="#cb47-350" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-351"><a href="#cb47-351" aria-hidden="true" tabindex="-1"></a>        test_dataset <span class="op">=</span> Dataset.from_dict(kv_pairs)</span>
<span id="cb47-352"><a href="#cb47-352" aria-hidden="true" tabindex="-1"></a>        test_ddict <span class="op">=</span> DatasetDict()</span>
<span id="cb47-353"><a href="#cb47-353" aria-hidden="true" tabindex="-1"></a>        test_ddict[<span class="st">'test'</span>] <span class="op">=</span> test_dataset</span>
<span id="cb47-354"><a href="#cb47-354" aria-hidden="true" tabindex="-1"></a>        test_ddict_tokenized <span class="op">=</span> test_ddict.<span class="bu">map</span>(partial(tokenize_function,tok<span class="op">=</span><span class="va">self</span>.tokenizer,</span>
<span id="cb47-355"><a href="#cb47-355" aria-hidden="true" tabindex="-1"></a>                                                      is_split_into_words<span class="op">=</span><span class="va">self</span>.is_split_into_words,</span>
<span id="cb47-356"><a href="#cb47-356" aria-hidden="true" tabindex="-1"></a>                                                      max_length<span class="op">=</span><span class="va">self</span>.max_length),batched<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-357"><a href="#cb47-357" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-358"><a href="#cb47-358" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> test_ddict_tokenized</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L96" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="textdatamain" class="level3">
<h3 class="anchored" data-anchor-id="textdatamain">TextDataMain</h3>
<blockquote class="blockquote">
<pre><code> TextDataMain (df:pandas.core.frame.DataFrame, main_content:str,
               metadatas=[], label_names=None,
               class_names_predefined=None, val_ratio:list|float|None=0.2,
               split_cols:list|str=None, content_tfms=[], aug_tfms=[],
               process_metadatas=True, seed=None, cols_to_keep=None,
               shuffle_trn=True)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>pd.DataFrame</td>
<td></td>
<td>The main dataframe</td>
</tr>
<tr class="even">
<td>main_content</td>
<td>str</td>
<td></td>
<td>Name of the text column</td>
</tr>
<tr class="odd">
<td>metadatas</td>
<td>list</td>
<td>[]</td>
<td>Names of the metadata columns</td>
</tr>
<tr class="even">
<td>label_names</td>
<td>NoneType</td>
<td>None</td>
<td>Names of the label (dependent variable) columns</td>
</tr>
<tr class="odd">
<td>class_names_predefined</td>
<td>NoneType</td>
<td>None</td>
<td>(Optional) List of names associated with the labels (same index order)</td>
</tr>
<tr class="even">
<td>val_ratio</td>
<td>list | float | None</td>
<td>0.2</td>
<td>Ratio of data for validation set. If given a list, validation set will be chosen based on indices in this list</td>
</tr>
<tr class="odd">
<td>split_cols</td>
<td>list | str</td>
<td>None</td>
<td>Column(s) needed to do stratified shuffle split</td>
</tr>
<tr class="even">
<td>content_tfms</td>
<td>list</td>
<td>[]</td>
<td>A list of text transformations</td>
</tr>
<tr class="odd">
<td>aug_tfms</td>
<td>list</td>
<td>[]</td>
<td>A list of text augmentations</td>
</tr>
<tr class="even">
<td>process_metadatas</td>
<td>bool</td>
<td>True</td>
<td>Whether to do simmple text processing on the chosen metadatas</td>
</tr>
<tr class="odd">
<td>seed</td>
<td>NoneType</td>
<td>None</td>
<td>Random seed</td>
</tr>
<tr class="even">
<td>cols_to_keep</td>
<td>NoneType</td>
<td>None</td>
<td>Columns to keep after all processings</td>
</tr>
<tr class="odd">
<td>shuffle_trn</td>
<td>bool</td>
<td>True</td>
<td>Whether to shuffle the train set</td>
</tr>
</tbody>
</table>
<p>Let’s start a step-by-step walkthrough on how to use this class</p>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>DATA_PATH <span class="op">=</span> Path(<span class="st">'sample_data'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="constructor-class-method-calls" class="level3">
<h3 class="anchored" data-anchor-id="constructor-class-method-calls">Constructor/ Class Method calls</h3>
<p>If you just want to get the dataframe from the csv path, set <code>return_df=True</code>. You still have the input validation precheck functionality.</p>
<div id="cell-50" class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> TextDataMain.from_csv(DATA_PATH<span class="op">/</span><span class="st">'sample_large.csv'</span>,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                            return_df<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Input Validation Precheck -----
DataFrame contains duplicated values!
-----&gt; Number of duplications: 16 rows</code></pre>
</div>
</div>
<p>The <code>Input Validation Precheck</code> will check for missing values and duplicate rows in the csv file. Since there’s no such thing in our sample dataset, we won’t see anything here</p>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">Content</th>
<th data-quarto-table-cell-role="th">L1</th>
<th data-quarto-table-cell-role="th">L2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">556</td>
<td>Non Owned</td>
<td>Xinh quá mấy chị,e còn dư 50 sét thôi! #35k 1s...</td>
<td>Others</td>
<td>Cannot defined</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1318</td>
<td>iOS</td>
<td>k sử dụng dc mã giảm giá, nhập vào rồi kêu lỗi...</td>
<td>Feature</td>
<td>Apply Voucher</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1852</td>
<td>Google Play</td>
<td>Cách shopee giải quyết vấn đề quá là TỆ</td>
<td>Services</td>
<td>Contact Agent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">901</td>
<td>Google Play</td>
<td>Lỗi không vào được ứng dụng, nhà điều hành có ...</td>
<td>Feature</td>
<td>App performance</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>iOS</td>
<td>Cảm thấy tệ</td>
<td>Others</td>
<td>Cannot defined</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-53" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df.Source.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Source
Google Play    1434
Non Owned       499
Owned           139
iOS             124
HC search        73
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Let’s say you are happy with this dataframe (after you did some others preprocessing), then you can start creating a <code>TextDataMain</code> object</p>
<p>For this dataframe, I want to - Build a text classification model, with main text in <code>Content</code> column, metadatas is <code>Source</code>, and the label is <code>L1</code> - Perform <code>apply_word_tokenize</code> with text normalization (this is “text transformation”) - For augmentation, I want to perform: Oversampling the <code>Owned, Non Owned and HC Search</code> from column <code>Source</code>, then add some the Vietnamese no-accent text. Note that all of these are called “text augmentation”</p>
<p>Let’s define these transformations</p>
<blockquote class="blockquote">
<p>For Text Transformation</p>
</blockquote>
<div id="cell-57" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>awt_tfm <span class="op">=</span> partial(apply_word_tokenize,normalize_text<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># You can also set a __name__ to your augmentation function. </span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This way you will have meaningful text messages as outputs</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>awt_tfm.<span class="va">__name__</span><span class="op">=</span><span class="st">'UTS Word Tokenization With Normalization'</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>txt_tfms<span class="op">=</span>[awt_tfm]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>For Text Augmentation</p>
</blockquote>
<div id="cell-59" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># apply_to_all means I will apply this augmentation to all the data </span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (including the original data and the augmented data/transformed data from previous augmentation/transformation)</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>over_nonown_tfm <span class="op">=</span> partial(sampling_with_condition,query<span class="op">=</span><span class="st">'Source=="non owned"'</span>,frac<span class="op">=</span><span class="fl">0.5</span>,seed<span class="op">=</span><span class="dv">42</span>,apply_to_all<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>over_nonown_tfm.<span class="va">__name__</span> <span class="op">=</span> <span class="st">'Oversampling Non Owned'</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>over_own_tfm <span class="op">=</span> partial(sampling_with_condition,query<span class="op">=</span><span class="st">'Source=="owned"'</span>,frac<span class="op">=</span><span class="dv">2</span>,seed<span class="op">=</span><span class="dv">42</span>,apply_to_all<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>over_own_tfm.<span class="va">__name__</span> <span class="op">=</span> <span class="st">'Oversampling Owned'</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>over_hc_tfm <span class="op">=</span> partial(sampling_with_condition,query<span class="op">=</span><span class="st">'Source=="hc search"'</span>,frac<span class="op">=</span><span class="fl">2.5</span>,seed<span class="op">=</span><span class="dv">42</span>,apply_to_all<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>over_hc_tfm.<span class="va">__name__</span> <span class="op">=</span> <span class="st">'Oversampling HC search'</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>remove_accent_tfm <span class="op">=</span> partial(remove_vnmese_accent,frac<span class="op">=</span><span class="dv">1</span>,seed<span class="op">=</span><span class="dv">42</span>,apply_to_all<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>remove_accent_tfm.<span class="va">__name__</span> <span class="op">=</span> <span class="st">'Add No-Accent Text'</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>aug_tfms <span class="op">=</span> [over_nonown_tfm,over_own_tfm,over_hc_tfm,remove_accent_tfm]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-60" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tdm <span class="op">=</span> TextDataMain(df,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                    main_content<span class="op">=</span><span class="st">'Content'</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                    metadatas<span class="op">=</span><span class="st">'Source'</span>, <span class="co"># You can put a list of multiple metadatas</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                    label_names<span class="op">=</span><span class="st">'L1'</span>, <span class="co"># You can put a list of multiple labels</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                    val_ratio<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                    split_cols<span class="op">=</span><span class="st">'L1'</span>, <span class="co"># You can even put a list of multiple columns to be used for validation splitting</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                    content_tfms <span class="op">=</span> txt_tfms, <span class="co"># You can add multiple content transformation functions ...</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                    aug_tfms <span class="op">=</span> aug_tfms, <span class="co"># ... as well as augmentation functions</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                    process_metadatas<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                    seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                    shuffle_trn<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Input Validation Precheck -----
DataFrame contains duplicated values!
-----&gt; Number of duplications: 16 rows</code></pre>
</div>
</div>
<p>If we want to directly create a <code>TextDataMain</code> object from our csv file, we can instead use this:</p>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>tdm <span class="op">=</span> TextDataMain.from_csv(DATA_PATH<span class="op">/</span><span class="st">'sample_large.csv'</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                            return_df<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                            main_content<span class="op">=</span><span class="st">'Content'</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                            metadatas<span class="op">=</span><span class="st">'Source'</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                            label_names<span class="op">=</span><span class="st">'L1'</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                            val_ratio<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                            split_cols<span class="op">=</span><span class="st">'L1'</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                            content_tfms <span class="op">=</span> txt_tfms,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                            aug_tfms <span class="op">=</span> aug_tfms,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                            process_metadatas<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                            seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                            shuffle_trn<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Input Validation Precheck -----
DataFrame contains duplicated values!
-----&gt; Number of duplications: 16 rows</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L354" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="textdatamain.to_df" class="level3">
<h3 class="anchored" data-anchor-id="textdatamain.to_df">TextDataMain.to_df</h3>
<blockquote class="blockquote">
<pre><code> TextDataMain.to_df ()</code></pre>
</blockquote>
<p>To execute all the defined processings and return a dataframe</p>
<p>Note that all the previous constructor calls do not do any heavy processing yet.</p>
<p>To actually run all the processes, one can call <code>TextDataMain.to_df()</code></p>
<div id="cell-65" class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_processed <span class="op">=</span> tdm.to_df()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------------- Start Main Text Processing --------------------
----- Metadata Simple Processing &amp; Concatenating to Main Content -----
----- Label Encoding -----
-------------------- Text Transformation --------------------
----- UTS Word Tokenization With Normalization -----
-------------------- Train Test Split --------------------
Previous Validation Percentage: 20.009%
- Before leak check
Size: 454
- After leak check
Size: 447
- Number of rows leaked: 7, or 1.54% of the original validation (or test) data
Current Validation Percentage: 19.7%
-------------------- Text Augmentation --------------------
Train data size before augmentation: 1822
----- Oversampling Non Owned -----
Train data size after THIS augmentation: 2020
----- Oversampling Owned -----
Train data size after THIS augmentation: 2248
----- Oversampling HC search -----
Train data size after THIS augmentation: 2390
----- Add No-Accent Text -----
Train data size after THIS augmentation: 4780
Train data size after ALL augmentation: 4780</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████████████████████████████████████████████████████████████████████████| 2269/2269 [00:03&lt;00:00, 599.84it/s]
100%|████████████████████████████████████████████████████████████████████████████| 2390/2390 [00:00&lt;00:00, 19530.97it/s]</code></pre>
</div>
</div>
<p>Notice this?</p>
<pre><code>Previous Validation Percentage: 20.0%
- Before leak check
Size: 14
- After leak check
Size: 14
- Number of rows leaked: 0, or 0.00% of the original validation (or test) data
Current Validation Percentage: 20.0%</code></pre>
<p>After performing train/test split, the <code>TextDataMain</code> object also perform a “leak check”: After <code>text_transformation</code> is performed, it will compare the text from <code>Content</code> value in the validation set to the <code>Content</code> text in the train set. Any duplications (texts that belong to both set) will be removed from validation set.</p>
<div id="cell-67" class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_processed.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Content</th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">L1</th>
<th data-quarto-table-cell-role="th">is_valid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5090</td>
<td>non owned - https://shopee.vn/maybeaty like và...</td>
<td>non owned</td>
<td>5</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2280</td>
<td>owned -_Địa chị này dám giao ko a . 😂</td>
<td>owned</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1258</td>
<td>google play - ble</td>
<td>google play</td>
<td>5</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3743</td>
<td>google play - Ko dừng tự_động cập_nhật được</td>
<td>google play</td>
<td>3</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4624</td>
<td>owned - Như này là sao ạ</td>
<td>owned</td>
<td>5</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Note that, since we have metadatas, the metadatas is concatenated to the front of the texture content</p>
<div id="cell-69" class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_processed.Content.sample(<span class="dv">5</span>).values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array(['owned - 🚀 *_* ĐÓN_CHÀO ƯU_ĐÃI VÀNG VÀO THỨ_BA VỚI PHIÊN CHỢ VOUCHER_*_*_🚀_*_🎁 Miễn_phí tối_đa 50K cho 1 giờ khi chọn dịch_vụ dọn_dẹp nhà từ bTaskee *_🤗_Giảm ngay 20 % gói học Toán 12 tháng từ VioEdu_*_🤑_ShopBack tặng ngay 25K tiền thưởng cho đơn hàng từ 150K_*_😍_Giảm 70K cho hóa đơn từ 300K , áp_dụng cho tất_cả dịch_vụ làm đẹp tại Lamia 🎉 ️ 🎉_Chỉ từ 1000 xu , SỐ_LƯỢNG CÓ_HẠN ➡_[_http://shopee.vn/ShopeeDoiXu ] ( http://shopee.vn/ShopeeDoiXu ) ___________________________💥_10.10_SIÊU_SALE CHÍNH HÃNG - VẪN CÒN SALE_🎊_▶_️ https://shopee.vn/1010-Sieu-Sale-Chinh-Hang Săn thêm ưu_đãi Xtra duy_nhất 11.10 : 🎁 Miễn_phí vận_chuyển 0 Đ_🎁_Thương_hiệu hoàn xu tới 50 % 🎁 Thu_thập voucher , nhận đến 1.2 triệu 🎁 4 Khung giờ săn sale đậm : 0H - 9H - 12H - 21H_#_Shopee1010SieuSaleChinhHang',
       'ios - Dat_hang cu bi tu hoan hang ve rat la buc :)',
       'owned - Các bạn từng mua gì đáng đồng_tiền nhất trên Sốp_Pi ?',
       'google play - Được',
       'google play - Chon thanh_toan ma cu the ghi no roi chuyen_khoan , bay di dau cai thanh_toan khi nhan hang roi'],
      dtype=object)</code></pre>
</div>
</div>
<p>We now have a new dataframe with only the necessary columns (the processed text column, metadatas, label, and <code>is_valid</code> which tells you which row belongs to the validation set). Notice that our class has also encode our label for us</p>
<p>Our TextDataMain object also stores other useful attributes, such as:</p>
<div id="cell-72" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The entire processed dataframe, similar to the df_processed above</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>tdm.df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Content</th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">L1</th>
<th data-quarto-table-cell-role="th">is_valid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>hc search - làm_sao để hết lỗi m02</td>
<td>hc search</td>
<td>3</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>hc search - xin chao</td>
<td>hc search</td>
<td>5</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>owned - 8 NGAY DUA DON , TRUNG VOUCHER 8 THA...</td>
<td>owned</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>google play - 🤬_😡_🤬_😡</td>
<td>google play</td>
<td>5</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>hc search - mua hàng quốc_tế như thế_nào</td>
<td>hc search</td>
<td>4</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># class names (This will be a list of list, as this class can handle multi-label classification)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>tdm.label_lists</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[['Buyer complained seller',
  'Commercial',
  'Delivery',
  'Feature',
  'Order/Item',
  'Others',
  'Payment',
  'Return/Refund',
  'Services',
  'Shopee account']]</code></pre>
</div>
</div>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a dictionary storing unique value for each provided metadata</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>tdm.metadata_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'Source': ['google play', 'hc search', 'ios', 'non owned', 'owned']}</code></pre>
</div>
</div>
<p>If we want to see how a HuggingFace’s tokenizer work on our processed text:</p>
<div id="cell-76" class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"vinai/phobert-base"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.</code></pre>
</div>
</div>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this will pick a random text from train set to show</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>tdm.tokenizer_explain_single(tokenizer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>----- Tokenizer Explained -----
--- Input ---
google play - Mang ro manh nhung lai dang nhap khong duoc : &lt;

--- Tokenized results --- 
{'input_ids': [0, 38970, 14015, 31, 8283, 7135, 24136, 12088, 5135, 19058, 2008, 18679, 3014, 2662, 6190, 22899, 27, 8452, 2], 'token_type_ids': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

--- Results from tokenizer.convert_ids_to_tokens ---
['&lt;s&gt;', 'google', 'play', '-', 'Mang', 'ro', 'manh', 'nhung', 'lai', 'dang', 'nh@@', 'ap', 'kh@@', 'ong', 'du@@', 'oc', ':', '&lt;', '&lt;/s&gt;']

--- Results from tokenizer.decode --- 
&lt;s&gt; google play - Mang ro manh nhung lai dang nhap khong duoc : &lt; &lt;/s&gt;
</code></pre>
</div>
</div>
<p>By doing this, we can see how the tokenizer interact with our text.</p>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L367" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="textdatamain.to_datasetdict" class="level3">
<h3 class="anchored" data-anchor-id="textdatamain.to_datasetdict">TextDataMain.to_datasetdict</h3>
<blockquote class="blockquote">
<pre><code> TextDataMain.to_datasetdict (tokenizer, is_split_into_words=False,
                              max_length=None, trn_ratio=1.0, seed=42)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>tokenizer</td>
<td></td>
<td></td>
<td>Tokenizer (preferably from HuggingFace)</td>
</tr>
<tr class="even">
<td>is_split_into_words</td>
<td>bool</td>
<td>False</td>
<td>Is text split into list or not</td>
</tr>
<tr class="odd">
<td>max_length</td>
<td>NoneType</td>
<td>None</td>
<td>pad to model’s allowed max length (default is max_sequence_length)</td>
</tr>
<tr class="even">
<td>trn_ratio</td>
<td>float</td>
<td>1.0</td>
<td>Portion of training data to be converted to datasetdict. Useful for sample experiments</td>
</tr>
<tr class="odd">
<td>seed</td>
<td>int</td>
<td>42</td>
<td>Random seed</td>
</tr>
</tbody>
</table>
<p>Since we need to convert our data to HuggingFace’s DatasetDict format in order to utilize HuggingFace’s model well, we can directly export datasetdict using <code>TextDataMain.to_datasetdict</code></p>
<div id="cell-81" class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ddict_sample <span class="op">=</span> tdm.to_datasetdict(tokenizer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------------- Map Tokenize Function --------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-82" class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>ddict_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>DatasetDict({
    train: Dataset({
        features: ['text', 'label', 'Source', 'input_ids', 'token_type_ids', 'attention_mask'],
        num_rows: 4780
    })
    validation: Dataset({
        features: ['text', 'label', 'Source', 'input_ids', 'token_type_ids', 'attention_mask'],
        num_rows: 447
    })
})</code></pre>
</div>
</div>
<div id="cell-83" class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>ddict_sample[<span class="st">'train'</span>][<span class="st">'text'</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'hc search - làm_sao để hết lỗi m02'</code></pre>
</div>
</div>
<div id="cell-84" class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ddict_sample[<span class="st">'train'</span>][<span class="st">'input_ids'</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0, 1340, 1894, 51139, 31, 2407, 24, 351, 1210, 1387, 3974, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</code></pre>
</div>
</div>
<p>Note that PhoBert will auto-pad our sentence to its model max_sequence_length, which is 256</p>
<div id="cell-86" class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(ddict_sample[<span class="st">'train'</span>][<span class="st">'input_ids'</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>256</code></pre>
</div>
</div>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>ddict_sample[<span class="st">'train'</span>][<span class="st">'label'</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/anhquan0412/that-nlp-library/blob/main/that_nlp_library/text_main.py#L150" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="textdatamain.save_as_pickles" class="level3">
<h3 class="anchored" data-anchor-id="textdatamain.save_as_pickles">TextDataMain.save_as_pickles</h3>
<blockquote class="blockquote">
<pre><code> TextDataMain.save_as_pickles (fname, parent='pickle_files',
                               drop_data_attributes=False)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fname</td>
<td></td>
<td></td>
<td>Name of the pickle file</td>
</tr>
<tr class="even">
<td>parent</td>
<td>str</td>
<td>pickle_files</td>
<td>Parent folder</td>
</tr>
<tr class="odd">
<td>drop_data_attributes</td>
<td>bool</td>
<td>False</td>
<td>Whether to drop all large-size data attributes</td>
</tr>
</tbody>
</table>
<p>As the transformations/augmentations can take time for large dataset, we want to save our TextDataMain object. We can use <code>TextDataMain.save_as_pickles</code> to export a pickle file</p>
<div id="cell-90" class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>tdm.save_as_pickles(<span class="st">'my_tdm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then you can load it with</p>
<div id="cell-92" class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>tdm2 <span class="op">=</span> TextDataMain.from_pickle(<span class="st">'my_tdm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>… and access all the attributes</p>
<div id="cell-94" class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>tdm2.df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Content</th>
<th data-quarto-table-cell-role="th">Source</th>
<th data-quarto-table-cell-role="th">L1</th>
<th data-quarto-table-cell-role="th">is_valid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>hc search - làm_sao để hết lỗi m02</td>
<td>hc search</td>
<td>3</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>hc search - xin chao</td>
<td>hc search</td>
<td>5</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>owned - 8 NGAY DUA DON , TRUNG VOUCHER 8 THA...</td>
<td>owned</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>google play - 🤬_😡_🤬_😡</td>
<td>google play</td>
<td>5</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>hc search - mua hàng quốc_tế như thế_nào</td>
<td>hc search</td>
<td>4</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-95" class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>tdm2.label_lists[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Buyer complained seller',
 'Commercial',
 'Delivery',
 'Feature',
 'Order/Item',
 'Others',
 'Payment',
 'Return/Refund',
 'Services',
 'Shopee account']</code></pre>
</div>
</div>
<div id="cell-96" class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>tdm2.metadata_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'Source': ['google play', 'hc search', 'ios', 'non owned', 'owned']}</code></pre>
</div>
</div>
<p>Let’s check the file size</p>
<div id="cell-98" class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>file_stats <span class="op">=</span> os.stat(Path(<span class="st">'pickle_files/my_tdm.pkl'</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'File Size in MegaBytes is </span><span class="sc">{</span>file_stats<span class="sc">.</span>st_size <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File Size in MegaBytes is 13.537714004516602</code></pre>
</div>
</div>
<p>As it saves the entire processed dataframe (and datasetdict if you call <code>to_datasetdict</code>), the pickle size can be large. In some scenario you don’t need to store these data attributes (as inference time, or in production). Thus one can save a lighter pickle file by setting <code>drop_data_attributes</code> to <code>True</code></p>
<div id="cell-100" class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>tdm.save_as_pickles(<span class="st">'my_lightweight_tdm'</span>,drop_data_attributes<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-101" class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>file_stats <span class="op">=</span> os.stat(Path(<span class="st">'pickle_files/my_lightweight_tdm.pkl'</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'File Size in MegaBytes is </span><span class="sc">{</span>file_stats<span class="sc">.</span>st_size <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File Size in MegaBytes is 3.1605300903320312</code></pre>
</div>
</div>
<p>We will see a bigger file size reduction when we work with much larger dataset</p>
<div id="cell-103" class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>tdm_light <span class="op">=</span> TextDataMain.from_pickle(<span class="st">'my_lightweight_tdm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can still access some important attributes (except for any data attributes, such as <code>df</code> or <code>main_ddict</code></p>
<div id="cell-105" class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>tdm_light.label_lists[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['Buyer complained seller',
 'Commercial',
 'Delivery',
 'Feature',
 'Order/Item',
 'Others',
 'Payment',
 'Return/Refund',
 'Services',
 'Shopee account']</code></pre>
</div>
</div>
<div id="cell-106" class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>tdm_light.metadata_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'Source': ['google play', 'hc search', 'ios', 'non owned', 'owned']}</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/anhquan0412\.github\.io\/that-nlp-library");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/anhquan0412/that-nlp-library/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>